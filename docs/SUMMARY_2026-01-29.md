# Kantoku é–‹ç™¼ç’°å¢ƒé…ç½®ç¸½çµ

**æ—¥æœŸ**: 2026-01-29  
**ç‹€æ…‹**: âœ… å®Œæ•´é–‹ç™¼ç’°å¢ƒå·²å°±ç·’

---

## ğŸ¯ ä»Šæ—¥å®Œæˆçš„å·¥ä½œ

### 1. âœ… Supabase é€£æ¥æ¸¬è©¦ä¿®å¾©

**å•é¡Œ**: 
- `public.ping()` RPC å‡½æ•¸ä¸å­˜åœ¨
- iOS ç„¡æ³•æ¸¬è©¦åŸºç¤é€£æ¥

**è§£æ±º**: 
- æ”¹ç”¨æŸ¥è©¢ `learning_stages` è¡¨æ¸¬è©¦é€£æ¥
- æ›´ç©©å®šï¼Œç„¡éœ€é¡å¤–è¨­ç½®

**æ–‡ä»¶**: `ios/kantoku/Services/ConnectionTestService.swift:38-70`

---

### 2. âœ… æ¸¬è©¦å¸³è™Ÿé…ç½®

**å•é¡Œ**: 
- æ¸¬è©¦å¸³è™Ÿå¯†ç¢¼ç¡¬ç·¨ç¢¼åœ¨ä»£ç¢¼ä¸­
- ä¸å®‰å…¨ï¼Œé›£ä»¥ç¶­è­·

**è§£æ±º**: 
- ç§»è‡³ `Config.local.xcconfig`
- æ”¯æ´ç’°å¢ƒè®Šæ•¸é…ç½®
- å‰µå»ºç¯„æœ¬æ–‡ä»¶çµ¦åœ˜éšŠæˆå“¡

**é…ç½®**:
```xcconfig
TEST_EMAIL = test@kantoku.local
TEST_PASSWORD = Test123456!
```

**æ–‡æª”**: `docs/ios/TEST_ACCOUNT_SETUP.md`

---

### 3. âœ… Supabase Storage Policies

**å•é¡Œ**: 
- `submissions` bucket å­˜åœ¨ä½†ç„¡æ³•è¨ªå•
- Storage æ¸¬è©¦å¤±æ•—

**è§£æ±º**: 
- å‰µå»ºå®Œæ•´çš„ Storage policies
- `service_role` å…¨æ¬Šé™ï¼ˆå¾Œç«¯ç”¨ï¼‰
- `authenticated` å—é™æ¬Šé™ï¼ˆiOS App ç”¨ï¼‰

**SQL**: `docs/Supabase/storage_policies.sql`

**æ–‡æª”**: 
- `docs/Supabase/STORAGE_SETUP.md`
- `docs/Supabase/SERVICE_ROLE_GUIDE.md`

---

### 4. âœ… n8n ç’°å¢ƒé…ç½®ï¼ˆå¤šç’°å¢ƒæ”¯æ´ï¼‰

**å•é¡Œ**: 
- iOS æ¨¡æ“¬å™¨ç„¡æ³•ç”¨ `localhost` é€£æ¥ Mac
- éœ€è¦æ”¯æ´é–‹ç™¼/æ­£å¼ç’°å¢ƒåˆ‡æ›

**è§£æ±º**: 
- ä½¿ç”¨ Mac hostname (`neven.local`)
- å‰µå»ºå¤šç’°å¢ƒé…ç½®æ–‡ä»¶
- æ”¯æ´ä¸€éµåˆ‡æ›

**é…ç½®æ–‡ä»¶**:
```
Config.local.xcconfig       â†’ å¼•å…¥ç•¶å‰ç’°å¢ƒ
Config.development.xcconfig â†’ é–‹ç™¼ç’°å¢ƒ (neven.local:5678)
Config.production.xcconfig  â†’ æ­£å¼ç’°å¢ƒï¼ˆå¾…é…ç½®ï¼‰
```

**æ–‡æª”**: 
- `docs/HOSTNAME_SETUP.md`
- `docs/ios/MULTI_ENVIRONMENT_SETUP.md`
- `docs/ENVIRONMENT_COMPLETE.md`

---

### 5. âœ… n8n Webhook ç”Ÿç”¢æ¨¡å¼

**å•é¡Œ**: 
- Webhook ä½¿ç”¨æ¸¬è©¦æ¨¡å¼ (`/webhook-test/`)
- éœ€è¦æ‰‹å‹•é»æ“Šã€Œç›£è½ã€æ‰èƒ½å‘¼å«
- iOS App ç„¡æ³•ç›´æ¥ä½¿ç”¨

**è§£æ±º**: 
- èªªæ˜å¦‚ä½•å•Ÿå‹•ç”Ÿç”¢æ¨¡å¼
- å‰µå»ºæ¸¬è©¦è…³æœ¬
- æä¾›å®Œæ•´è¨­ç½®æŒ‡å—

**é—œéµæ“ä½œ**:
1. åœ¨ n8n UI å•Ÿå‹• workflows (Inactive â†’ Active)
2. ä½¿ç”¨ç”Ÿç”¢ URL: `/webhook/generate-tasks`

**æ–‡æª”**: `docs/n8n/WEBHOOK_PRODUCTION_SETUP.md`

---

### 6. âœ… æ¸¬è©¦æ•¸æ“šè‡ªå‹•æ¸…ç†

**å•é¡Œ**: 
- æ¸¬è©¦å¾Œç•™ä¸‹åƒåœ¾æ•¸æ“š
- ç´¯ç©åœ¨ Supabase å½±éŸ¿æ€§èƒ½

**è§£æ±º**: 
- è¿½è¹¤æ¸¬è©¦å‰µå»ºçš„æ‰€æœ‰è³‡æº
- æ¸¬è©¦å®Œæˆå¾Œè‡ªå‹•æ¸…ç†
- æä¾›æ‰‹å‹•æ¸…ç† SQL è…³æœ¬

**å¯¦ç¾**: `ios/kantoku/Services/ConnectionTestService.swift:378-444`

**æ–‡æª”**: 
- `docs/ios/TEST_DATA_CLEANUP.md`
- `docs/Supabase/cleanup_test_data.sql`

---

### 7. âœ… æ¸¬è©¦å·¥å…·å’Œè…³æœ¬

**å‰µå»ºçš„å·¥å…·**:

1. **`test-n8n-connection.sh`**
   - æ¸¬è©¦ localhostã€hostnameã€IP é€£æ¥
   - å½©è‰²è¼¸å‡ºçµæœ
   - ä¸€éµé©—è­‰ç’°å¢ƒ

2. **`QUICK_START.md`**
   - 3 åˆ†é˜å¿«é€Ÿå•Ÿå‹•æŒ‡å—
   - æ–°æ‰‹å‹å¥½
   - æ•…éšœæ’é™¤

---

## ğŸ“ å‰µå»ºçš„æ–‡æª”

### iOS ç›¸é—œ
1. `docs/ios/TEST_ACCOUNT_SETUP.md` - æ¸¬è©¦å¸³è™Ÿè¨­ç½®
2. `docs/ios/MULTI_ENVIRONMENT_SETUP.md` - å¤šç’°å¢ƒé…ç½®
3. `docs/ios/TEST_DATA_CLEANUP.md` - æ¸¬è©¦æ•¸æ“šæ¸…ç†

### Supabase ç›¸é—œ
4. `docs/Supabase/STORAGE_SETUP.md` - Storage é…ç½®æŒ‡å—
5. `docs/Supabase/SERVICE_ROLE_GUIDE.md` - è§’è‰²æ¬Šé™èªªæ˜
6. `docs/Supabase/storage_policies.sql` - Storage policies SQL
7. `docs/Supabase/cleanup_test_data.sql` - æ¸…ç†è…³æœ¬

### n8n ç›¸é—œ
8. `docs/n8n/WEBHOOK_PRODUCTION_SETUP.md` - Webhook è¨­ç½®

### é€šç”¨æ–‡æª”
9. `docs/HOSTNAME_SETUP.md` - Hostname ä½¿ç”¨æŒ‡å—
10. `docs/ENVIRONMENT_COMPLETE.md` - ç’°å¢ƒé…ç½®å®Œæˆå ±å‘Š
11. `QUICK_START.md` - å¿«é€Ÿå•Ÿå‹•æŒ‡å—
12. `docs/SUMMARY_2026-01-29.md` - æœ¬æ–‡æª”

---

## ğŸ“Š ç•¶å‰ç³»çµ±ç‹€æ…‹

### å·²é…ç½®ä¸¦æ¸¬è©¦ âœ…

```
iOS App (Xcode)
    â†“ (neven.local:5678)
n8n Workflows (Docker)
    â”œâ”€â”€ Generate Tasks (Active âœ…)
    â”œâ”€â”€ Review Submission (Active âœ…)
    â”œâ”€â”€ Generate Test (â³ Phase 7)
    â””â”€â”€ Grade Test (â³ Phase 7)
    â†“
Supabase (Cloud)
    â”œâ”€â”€ Database âœ…
    â”‚   â”œâ”€â”€ Tables (tasks, submissions, etc.)
    â”‚   â””â”€â”€ RLS Policies âœ…
    â”œâ”€â”€ Storage âœ…
    â”‚   â””â”€â”€ submissions bucket + Policies âœ…
    â””â”€â”€ Auth âœ…
        â””â”€â”€ Test User (test@kantoku.local) âœ…
    â†“
Gemini AI âœ…
```

### ç’°å¢ƒè®Šæ•¸

| æœå‹™ | URL | ç‹€æ…‹ |
|-----|-----|------|
| **Supabase** | `https://pthqgzpmsgsyssdatxnm.supabase.co` | âœ… é‹è¡Œä¸­ |
| **n8n (Dev)** | `http://neven.local:5678` | âœ… é‹è¡Œä¸­ |
| **n8n (Prod)** | å¾…é…ç½® | â³ æœªä¾† |
| **Gemini AI** | Google Cloud API | âœ… å·²é…ç½® |

---

## ğŸ§ª æ¸¬è©¦çµæœ

### iOS é€£æ¥æ¸¬è©¦ï¼ˆ7 é …ï¼‰

é‹è¡Œ `test-n8n-connection.sh`:

```
âœ… localhost:5678      - n8n æœ¬åœ°è¨ªå•
âœ… neven.local:5678    - iOS æ¨¡æ“¬å™¨è¨ªå•
âœ… 192.168.0.40:5678   - çœŸå¯¦è¨­å‚™è¨ªå•
```

é‹è¡Œ iOS App æ¸¬è©¦ï¼š

```
âœ… Supabase åŸºç¤é€£æ¥
âœ… Supabase Auth (test@kantoku.local)
âœ… Supabase Database (tasks è¡¨)
âœ… Supabase Storage (submissions bucket)
âœ… n8n åŸºç¤é€£æ¥
âœ… generate-tasks webhook
âœ… review-submission webhook
```

### n8n ç’°å¢ƒæ¸¬è©¦

```bash
curl http://localhost:5678/webhook/test-environment
```

çµæœï¼š
```json
{
  "success": true,
  "environment": "Kantoku Development",
  "tests": {
    "webhook": {"status": "âœ… PASSED"},
    "supabase": {"status": "âœ… PASSED", "stages_count": "10"},
    "gemini_ai": {"status": "âœ… PASSED", "model": "gemini-pro"}
  }
}
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥å·¥ä½œ

### ç«‹å³å¯åš

1. **åœ¨ n8n UI å•Ÿå‹• workflows**
   - Workflow 1: Generate Tasks (Inactive â†’ Active)
   - Workflow 2: Review Submission (Inactive â†’ Active)

2. **é–‹å§‹é–‹ç™¼åŠŸèƒ½**
   - Phase 6: Progress & Statistics
   - ä½¿ç”¨é…ç½®å¥½çš„æ¸¬è©¦ç’°å¢ƒ

3. **çœŸæ©Ÿæ¸¬è©¦**
   - åœ¨çœŸå¯¦ iPhone æ¸¬è©¦ï¼ˆåŒ Wi-Fiï¼‰
   - é©—è­‰æ‰€æœ‰åŠŸèƒ½

### æœªä¾†è¦åŠƒ

1. **éƒ¨ç½²æ­£å¼ç’°å¢ƒ**
   - è¨­ç½®é›²ç«¯ n8n ä¼ºæœå™¨
   - é…ç½® Production ç’°å¢ƒ
   - æ›´æ–° `Config.production.xcconfig`

2. **CI/CD**
   - è‡ªå‹•åŒ–æ¸¬è©¦
   - è‡ªå‹•éƒ¨ç½²
   - ç’°å¢ƒåˆ‡æ›è‡ªå‹•åŒ–

3. **ç›£æ§å’Œæ—¥èªŒ**
   - Supabase æ—¥èªŒç›£æ§
   - n8n åŸ·è¡Œæ­·å²åˆ†æ
   - éŒ¯èª¤è¿½è¹¤

---

## ğŸ“š é—œéµæ–‡æª”ç´¢å¼•

### å¿«é€Ÿé–‹å§‹
- **QUICK_START.md** - 3 åˆ†é˜å¿«é€Ÿå•Ÿå‹•

### æ¸¬è©¦ç›¸é—œ
- **docs/ios/TESTING_GUIDE.md** - å®Œæ•´æ¸¬è©¦æŒ‡å—
- **docs/ios/QUICK_TEST_GUIDE.md** - å¿«é€Ÿæ¸¬è©¦
- **docs/ios/TEST_ACCOUNT_SETUP.md** - æ¸¬è©¦å¸³è™Ÿ
- **docs/ios/TEST_DATA_CLEANUP.md** - æ•¸æ“šæ¸…ç†

### é…ç½®ç›¸é—œ
- **docs/ENVIRONMENT_COMPLETE.md** - ç’°å¢ƒé…ç½®ç¸½è¦½
- **docs/HOSTNAME_SETUP.md** - Hostname è¨­ç½®
- **docs/ios/MULTI_ENVIRONMENT_SETUP.md** - å¤šç’°å¢ƒé…ç½®

### Supabase ç›¸é—œ
- **docs/Supabase/STORAGE_SETUP.md** - Storage è¨­ç½®
- **docs/Supabase/SERVICE_ROLE_GUIDE.md** - è§’è‰²èªªæ˜
- **docs/Supabase/storage_policies.sql** - Policies SQL
- **docs/Supabase/cleanup_test_data.sql** - æ¸…ç†è…³æœ¬
- **docs/Supabase/SCHEMA.md** - è³‡æ–™åº«çµæ§‹

### n8n ç›¸é—œ
- **docs/n8n/WEBHOOK_PRODUCTION_SETUP.md** - Webhook è¨­ç½®
- **n8n-workflows/WORKFLOW_DESIGN.md** - Workflow è¨­è¨ˆ

---

## ğŸ”§ é—œéµé…ç½®æ–‡ä»¶

### iOS é…ç½®
```
ios/kantoku/Resources/
â”œâ”€â”€ Config.local.xcconfig          # æœ¬åœ°é…ç½®ï¼ˆå¼•å…¥ç’°å¢ƒï¼‰
â”œâ”€â”€ Config.development.xcconfig    # é–‹ç™¼ç’°å¢ƒ
â”œâ”€â”€ Config.production.xcconfig     # æ­£å¼ç’°å¢ƒ
â”œâ”€â”€ Config.local.xcconfig.template # ç¯„æœ¬
â””â”€â”€ Project-Info.plist            # ç’°å¢ƒè®Šæ•¸æ˜ å°„
```

### å¾Œç«¯é…ç½®
```
.env                    # ç’°å¢ƒè®Šæ•¸
docker-compose.yml      # n8n é…ç½®
```

### å·¥å…·è…³æœ¬
```
test-n8n-connection.sh  # é€£æ¥æ¸¬è©¦
```

---

## ğŸ’¡ æœ€ä½³å¯¦è¸ç¸½çµ

### âœ… DO

1. **ä½¿ç”¨ hostname è€Œä¸æ˜¯ IP**
   - `neven.local` æ¯” `192.168.0.40` æ›´ç©©å®š

2. **å•Ÿå‹• n8n workflows**
   - ç”Ÿç”¢ç’°å¢ƒéœ€è¦ Active ç‹€æ…‹
   - æ¸¬è©¦ç’°å¢ƒå¯ç”¨ webhook-test

3. **é‹è¡Œæ¸¬è©¦è…³æœ¬**
   - é–‹ç™¼å‰å…ˆæ¸¬è©¦é€£æ¥
   - `./test-n8n-connection.sh`

4. **å®šæœŸæ¸…ç†æ¸¬è©¦æ•¸æ“š**
   - è‡ªå‹•æ¸…ç†å·²å•Ÿç”¨
   - å¿…è¦æ™‚é‹è¡Œ SQL è…³æœ¬

### âŒ DON'T

1. **ä¸è¦æäº¤ Config.local.xcconfig**
   - å·²åœ¨ `.gitignore`
   - åŒ…å«æ•æ„Ÿè³‡è¨Š

2. **ä¸è¦åœ¨ iOS App ç”¨ localhost**
   - æ¨¡æ“¬å™¨ç„¡æ³•è¨ªå•
   - ä½¿ç”¨ `neven.local`

3. **ä¸è¦ç”¨æ¸¬è©¦ webhook URL**
   - iOS App æ‡‰è©²ç”¨ `/webhook/`
   - ä¸è¦ç”¨ `/webhook-test/`

---

## ğŸ‰ æˆå°±è§£é–

âœ… **å®Œæ•´çš„é–‹ç™¼ç’°å¢ƒ** - iOS + n8n + Supabase å…¨éƒ¨æ‰“é€š  
âœ… **å¤šç’°å¢ƒæ”¯æ´** - é–‹ç™¼/æ­£å¼ç’°å¢ƒè¼•é¬†åˆ‡æ›  
âœ… **è‡ªå‹•åŒ–æ¸¬è©¦** - ä¸€éµæ¸¬è©¦æ‰€æœ‰é€£æ¥  
âœ… **è‡ªå‹•æ¸…ç†** - æ¸¬è©¦æ•¸æ“šè‡ªå‹•æ¸…é™¤  
âœ… **å®Œæ•´æ–‡æª”** - 12+ ä»½è©³ç´°æ–‡æª”  
âœ… **æœ€ä½³å¯¦è¸** - Storage policies, è§’è‰²æ¬Šé™ç­‰  

---

## ğŸ“ˆ ä»£ç¢¼çµ±è¨ˆ

### æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

**iOS ä»£ç¢¼**:
- `ConnectionTestService.swift` - æ–°å¢è‡ªå‹•æ¸…ç†ï¼ˆ~50 è¡Œï¼‰
- `Config.development.xcconfig` - æ–°å»º
- `Config.production.xcconfig` - æ–°å»º
- `Config.local.xcconfig` - é‡æ§‹
- `Constants.swift` - æ–°å¢ç’°å¢ƒæª¢æŸ¥
- `Project-Info.plist` - æ–°å¢ç’°å¢ƒè®Šæ•¸

**é…ç½®æ–‡ä»¶**:
- `docker-compose.yml` - æ›´æ–° hostname
- `.env` - æ›´æ–° n8n URL

**SQL è…³æœ¬**:
- `storage_policies.sql` - 275 è¡Œ
- `cleanup_test_data.sql` - 180 è¡Œ

**æ¸¬è©¦è…³æœ¬**:
- `test-n8n-connection.sh` - 80 è¡Œ

**æ–‡æª”**:
- 12 ä»½æ–°æ–‡æª”ï¼Œç¸½è¨ˆ ~3500 è¡Œ

---

## ğŸš€ æº–å‚™å°±ç·’ï¼

é–‹ç™¼ç’°å¢ƒå·²å®Œå…¨é…ç½®ä¸¦æ¸¬è©¦å®Œæˆï¼Œå¯ä»¥é–‹å§‹ï¼š

1. âœ… iOS App é–‹ç™¼
2. âœ… n8n Workflow é–‹ç™¼
3. âœ… Supabase è³‡æ–™åº«æ“ä½œ
4. âœ… çœŸæ©Ÿæ¸¬è©¦
5. âœ… åœ˜éšŠå”ä½œ

---

**é…ç½®å®Œæˆï¼Œé–‹ç™¼æ„‰å¿«ï¼** ğŸŠ

**ä¸‹ä¸€å€‹é‡Œç¨‹ç¢‘**: Phase 6 - Progress & Statistics

---

**å‰µå»ºæ—¥æœŸ**: 2026-01-29  
**æœ€å¾Œæ›´æ–°**: 2026-01-29  
**ç‰ˆæœ¬**: 1.0
